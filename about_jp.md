# 日本語での詳しい説明
## 準備された秩序の崩壊モデルとは?
「準備された秩序の崩壊モデル」とは、端的に言えばフレームを安全に破壊して効率的に破棄できるモデルです。  
## 一般的なモデル
一般的には、フレームを破棄する際は一時的なデータ保管を必要とします。  
理由としては、破棄した後に使う値が二つあるからです。
1. 返り値
2. 戻り先フレーム情報
## このモデルでは
このモデルでは、一時的なデータ保管を必要としません。また、メモリ効率も改善できます。具体的には、
```
| 戻り先フレーム : A : 今のフレーム |
```
ここで、`A`というのを戻り先フレームと今のフレームが重なった部分とします。戻り先フレームでは`A`に返り値を、今のフレームでは`A`に何かしらの情報を期待しています。YSVMにおいては、今のフレームにおける、今読んでいるバイトコードのインデックスを保管しています。  
ここで、今のフレームのトップを返り値と仮定しますと、
```
| 戻り先フレーム : A : 今のフレーム, 返り値(=B)
```
というレイアウトになっています。ここで上のフレームを破棄すると
```
| 戻り先フレーム : B : 今のフレーム
// 今のフレーム内にある戻り先フレームのアドレスを、フレームアドレスに代入
| 今のフレーム, B
```
という流れで破棄できます。  

## 由来
「準備された秩序の崩壊モデル」と呼んでいるのは、フレームを積んだ時の、オペランドスタックのサイズと実態をわざと崩していること、そしてフレーム破棄をする際にフレームを違法な状態に持って行ったうえで安全な期間内で適切に破棄しているためです。

## 安全性
今読んでいるバイトコードのインデックスを上書きして問題ない理由は、YSVMのバイトコード実行の特徴からわかります。  
YSVMではバイトコードを実行し終わったのちに「今読んでいるバイトコードのインデックス」をインクリメントしています。そのため、単一バイトコード処理の中で崩壊させて修復するこの構造であれば、適切に動作します。  
「今読んでいるバイトコードのインデックス」というのは`RET`が呼び出された時点でその価値をなくしますので、このフレームレイアウトの場合では必要なくなった無意味なデータが先頭に来ます。そのため、安全に戻り値を入れられます。

## 効率面
一時変数を必要としないため、既存のモデルよりも効率的に動作します。既存のモデルでは、
```
値を一時的に避難させる
フレームを破棄する
返り値をPUSHする
```
という、三つの手順があるのに対してこのモデルでは
```
実質的に返り値をPUSHする
フレームを破棄する
```
という二つの手順で実現できます。

---

提案者: 87right  
初出: 2026年1月22日  